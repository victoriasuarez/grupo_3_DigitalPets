<!DOCTYPE html>
<html lang="en">
<%- include('../partials/head', {styles: ['normalize', 'styles' ,'header','footer','productDetail']}) %>

    <body>

        <%- include('../partials/header', { isLoggedIn, includeHeader: true }) %>
            <main>
                <div class="detail-heading">
                    <div class="list">
                        <ul>
                            <li><a href="/">INICIO</a></li>
                            <li><a href="#"><i class="fa fa-greater-than"></i><span>CATEGORIA</span></a></li>
                            <li><a href="#"><i class="fa fa-greater-than"></i><span>SUBCATEGORIA</span></a></li>
                        </ul>
                    </div>
                </div>
                <div class="detail-container">
                    <% if (locals.product) { %>
                        <div class="detail-product">
                            <div>
                                <img class="image-product" src="/images/<%= product.image %>" alt="image-product">
                            </div>
                            <div class="detail">
                                <div class="product">
                                    <h3>
                                        <%= product.name %>
                                    </h3>
                                    <h4>10kg</h4>
                                    <p class="price">$<%= product.price %>
                                    </p>
                                </div>
                                <div class="detail-options">
                                    <div class="wrapper">
                                        <span class="out">-</span>
                                        <span class="num">1</span>
                                        <span class="add">+</span>
                                    </div>
                                    <button class="btn btn-block add-to-cart-btn" 
                                    data-product-id="<%= product.id %>"
                                    data-product-name="<%= product.name %>"
                                    data-product-price="<%= product.price %>">
                                Agregar al carrito
                            </button>
                                </div>
                            </div>
                        </div>


                        <div class="detail-description">
                            <h3>Descripción:</h3>
                            <p>
                                <%= product.description %>
                            </p>
                        </div>
                        <% } else { %>
                            <h1>Producto no encontrado</h1>
                            <% } %>
                                <div class="suggested">
                                    <p>Productos Sugeridos</p>
                                </div>

                                <div class="sub-main-footer">
                                    <img class="image-footer" src="/images/producto-SabrositosGatoAdulto.webp"
                                        alt="image-footer">
                                    <div class="sub-main-descripcion">
                                        <p class="category">Perros</p>
                                        <p class="name">Kongo Gold Adultos x15kg</p>
                                        <p class="price">$13.500</p>
                                    </div>
                                </div>
                                <br>
                                <div class="sub-main-footer">
                                    <img class="image-footer" src="/images/Producto-AlimentoConejos.webp"
                                        alt="image-footer">
                                    <div class="sub-main-descripcion">
                                        <p class="category">Otros</p>
                                        <p class="name">Alimento para conejos x750gr</p>
                                        <p class="price">$2.000</p>
                                    </div>
                                </div>
                                <br>
                                <div class="sub-main-footer">
                                    <img class="image-footer" src="/images/Producto-KongoMedianoYAdulto.webp"
                                        alt="image-footer">
                                    <div class="sub-main-descripcion">
                                        <p class="category">Perros</p>
                                        <p class="name">Kongo - Mediano Y Adulto x10kg</p>
                                        <p class="price">$10.000</p>
                                    </div>
                                </div>

                </div>
            </main>
            <%- include ('../partials/footer') %>

                <script>
                    document.addEventListener("DOMContentLoaded", function () {
                    // Asigna los botones de incremento y decremento a las variables correspondientes
                    const add = document.querySelector(".add");
                    const out = document.querySelector(".out");
                    const num = document.querySelector(".num");

                    // Inicializa la variable quantity
                    let quantity = parseInt(num.innerText);  

                    const addToCartButtons = document.querySelectorAll(".add-to-cart-btn");

                    document.querySelector('.add-to-cart-btn').addEventListener('click', function() { console.log('Clicked!'); });


                    addToCartButtons.forEach(button => {
                        button.addEventListener("click", function () {
                            const productId = this.getAttribute("data-product-id");

                            // Realiza una solicitud AJAX para enviar la información al servidor
                            fetch('/cart', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({ productId, quantity }),
                            })
                            .then(response => response.json())
                            .then(data => {
                                // Puedes mostrar un mensaje de éxito al usuario si es necesario
                                console.log(data);
                            })
                            .catch(error => {
                                console.error('Error al agregar al carrito:', error);
                            });
                        });
                    });

                    // Resto del código para incrementar y decrementar la cantidad...
                    add.addEventListener("click", () => {
                        quantity++;
                        num.innerText = quantity;
                    });

                    out.addEventListener("click", () => {
                        if (quantity > 1) {
                            quantity--;
                            num.innerText = quantity;
                        }
                    });
                });
                </script>
    </body>

</html>